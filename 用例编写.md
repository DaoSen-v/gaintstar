###   1、编写项目配置文件

##### 1.1 项目配置文件总览

test_case文件夹下新建 projectSetting.json 项目配置文件

```json
{
	"environment": { 
		"default": "https://ec-gamma.casstime.com",  # 默认接口请求域名
		"web": "https://ec-gamma.casstime.com", 
		"app": "https://ec-gamma.casstime.com/terminal-api-v2"
	},
	"loginSetting": {
		"httpUser": {}, # http用户登录设置
		"webUser": {}, # web用户登录设置
		"appUser": {} # app用户登录设置
	},
	"platformHost": "http://124.71.56.59:8070" # 使用平台时平台域名地址
}
```

##### 1.2 项目用户登录配置

###### 1.2.1 httpUser 用户登录设置

① 支持miracle.py 中自定义函数登录

② 支持使用纯数据登录

```python
# miracle.py

def project_login(url, username, password):
    session = requests.session()
    response = session.post(url, json={"username": username, "password": password})
    try:
        token = response.json().get("detail").get("token")
        session.headers.update({"Authorization": f"Bearer {token}"})
        return session
    except Exception as e:
        raise e

```



```json
{	
    
    'user1': "${project_login(url='http://ctsp.casstime.com/api/auth/login/', username='username', password='password')}", # 使用miracle.py中自定义函数登录
    'user2': [ # 使用纯数据登录
        {
            'after': { # 发送接口请求后更新请求头信息（步骤节点最后执行）
                'header': {'Authorization': 'Bearer @{token}'}
            }, 
            'bodyType': 'json', # 接口请求数据类型
            'data': {'password': 'Xu173798', 'username': 'A02441'}, # 接口请求数据
            'extract': ['token'], # 接口提取参数
            'method': 'post', # 接口请求方法
            'url': 'http://ctsp.casstime.com/api/auth/login/' # 接口请求路径
        },
        {"请他步骤"："当登录步骤需要多步完成时， 可继续按照步骤1编写"}
    ]
}
```



###### 1.2.2 webUser 用户登录设置

① 支持miracle.py 中自定义函数登录

② 支持使用纯数据登录

```json
{
    "user1": "${web_login(*args, **kwargs)}"  # 可自定义函数登录
    "user2": {
    	"caps": {"browser": "firefox"},
		"login_step": [ # 登录步骤
           {
               "eventName": "打开页面", 'event': "open", 
               "url": "http://ctsp.casstime.com/login"
           },
           {
               "eventName": "输入用户名", "event": "input",
               "location": ["id", "username"], "input": "A02441"
           },
           {
               "eventName": "输入密码", "event": "input",
               "location": ["id", "password"], "input": "Xu173798"
           },
           {
               "eventName": "点击登录", "event": "click", 
               "location": ["id", "loginBtn"]
           }
        ]
	} 
}
```



###### 1.2.3 appUser 用户登录设置

① 支持miracle.py 中自定义函数登录

② 支持使用纯数据登录

```json
{
	"build_type": "yaml",
	"user1": {
		"hub": "",
		"caps": {  # 设备连接参数
            "platformName": "android",
            "deviceName": "",
            "appPackage": "",
            "appActivity": ""
        },
        "login_step": [ # 登录步骤
			{
                "eventName": "输入用户名", "event": "input",
                "location": [["xpath", "XXX", []]], "input": "a02441"
            },
            {
                "eventName": "输入密码", "event": "input",
                "location": ["xpath", "XXX"], "input": "123456"
            },
            {
                "eventName": "点击登录", "event": "click", "location": ["xpath", "XXX"]
            }
        ]
	}
}
```



### 2、纯文本json结构编写测试用例

备注：编写测试用例文件均在脚手架test_case文件夹下进行

2.1 接口测试用例编写

test_api.json：编写测试用例json文件时需以 test 开头

```json
# test_api.json
[
    {
        "caseLevel": "P1",   # 用例等级
        "caseName": "购物车下单", # 用例名称
        "caseTier": "项目-首页-添加购物车-下单", # 用例目录
        "parametrize": [ # 参数化数据，每一行会参数化出一条测试用例
            {"_title": "参数化数据1", "username": "A02441", "password":  "Xu173798"},
            {"_title": "参数化数据2", "username": "A02441", "password":  "xu1"}
        ],
        "caseNodes": [ # 测试用例节点, 每一个元素为一个接口测试步骤
            {
                "stepName": "查看商品详情", # 接口数据
                "driver": "api", # 驱动名称
                "modelSet":{  # 接口模型
                    "path": "/api/auth/login/", # 接口路径
                    "method": "post", # 接口请求方法
                    "dataType": "json" # 请求数据类型
                },
                "host": "http://ctsp.casstime.com", # 接口请求域名, 不写默认使用enviroment default地址
			   "user": "user1", # 请求接口使用用户名， 不写默认使用default
                "headers": {}, # 请求头数据更新
                "sleep": "", # 接口请求后等待时间
                "request": {"username": "@{username}", "password": "@{password}"},# 接口请求数据
                "assert": [{"eq":["status_code", 200]}], # 接口请求后断言
                "extract": ["message", "body"] # 接口请求后数据提取
            }
        ]
    }
]
```

##### 2.2 web ui用例编写

test_web.json：编写测试用例json文件时需以 test 开头



```json
# test_web.json
[
    {
        "caseLevel": "P1",   # 用例等级
        "caseName": "购物车下单", # 用例名称
        "caseTier": "项目-首页-添加购物车-下单", # 用例目录
        "parametrize": [ # 参数化数据，每一行会参数化出一条测试用例
            {"_title": "参数化数据1", "username": "A02441", "password":  "Xu173798"},
            {"_title": "参数化数据2", "username": "A02441", "password":  "xu1"}
        ],
        "caseNodes": [ # 测试用例节点, 每一个元素为一个接口测试步骤
            {
                "stepName": "查看商品详情", # 接口数据
                "driver": "api", # 驱动名称
                "modelSet":{  # 接口模型
                    "path": "/api/auth/login/", # 接口路径
                    "method": "post", # 接口请求方法
                    "dataType": "json" # 请求数据类型
                },
                "host": "http://ctsp.casstime.com", # 接口请求域名, 不写默认使用enviroment default地址
				"user": "user1", # 请求接口使用用户名， 不写默认使用default
                "headers": {}, # 请求头数据更新
                "sleep": "", # 接口请求后等待时间
                "request": {"username": "@{username}", "password": "@{password}"},# 接口请求数据
                "assert": [{"eq":["status_code", 200]}], # 接口请求后断言
                "extract": ["message", "body"] # 接口请求后数据提取
            }
        ]
    }
]
```



##### 2.3 app ui用例编写

test_app.json：编写测试用例json文件时需以 test 开头

```json
# test_app.json
[
    {
        "caseLevel": "P1",   # 用例等级
        "caseName": "购物车下单", # 用例名称
        "caseTier": "项目-首页-添加购物车-下单", # 用例目录
        "parametrize": [ # 参数化数据，每一行会参数化出一条测试用例
            {"_title": "参数化数据1", "username": "A02441", "password":  "Xu173798"},
            {"_title": "参数化数据2", "username": "A02441", "password":  "xu1"}
        ],
        "caseNodes": [ # 测试用例节点, 每一个元素为一个接口测试步骤
            {
                "stepName": "查看商品详情", # 接口数据
                "driver": "api", # 驱动名称
                "modelSet":{  # 接口模型
                    "path": "/api/auth/login/", # 接口路径
                    "method": "post", # 接口请求方法
                    "dataType": "json" # 请求数据类型
                },
                "host": "http://ctsp.casstime.com", # 接口请求域名, 不写默认使用enviroment default地址
				"user": "user1", # 请求接口使用用户名， 不写默认使用default
                "headers": {}, # 请求头数据更新
                "sleep": "", # 接口请求后等待时间
                "request": {"username": "@{username}", "password": "@{password}"},# 接口请求数据
                "assert": [{"eq":["status_code", 200]}], # 接口请求后断言
                "extract": ["message", "body"] # 接口请求后数据提取
            }
        ]
    }
]
```



### 3、使用py文件编写测试用例

##### 3.1 py文件编写接口测试用例

① 脚手架 test_case 文件夹新建文件 test_api.py

```python
# test_api.py
from tool.step import Step
from miracle import get_model, get_data

class TestApi(Step):
    def test_api_01(self)
```

##### 3.2 py文件编写web UI测试用例

① 脚手架 test_case 文件夹新建文件 test_web.py

```python
# test_web.py
from tool.step import Step
from miracle import get_model, get_data

class TestAp(Step)i:
    def test_api_01(self)
```



##### 3.2 py文件编写app UI测试用例

① 脚手架 test_case 文件夹新建文件 test_app.py

```python
# test_app.py
from tool.step import Step
from miracle import get_model, get_data

class TestAp(Step):
    def test_api_01(self)
```



